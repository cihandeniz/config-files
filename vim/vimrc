source $VIMRUNTIME/defaults.vim

call plug#begin('~/.vim/plugged')

" theme
Plug 'morhetz/gruvbox'
" yanks to multiple registers and allows to paste from a list
Plug 'vim-scripts/YankRing.vim'
" folder tree on left
Plug 'preservim/nerdtree'
" shows symbols according to git status in the tree
Plug 'Xuyuanp/nerdtree-git-plugin'
" highlight files and folders according to their types
Plug 'tiagofumo/vim-nerdtree-syntax-highlight'
" status bar
Plug 'vim-airline/vim-airline'
" themes for status bar
Plug 'vim-airline/vim-airline-themes'
" highlight other uses of current word
Plug 'RRethy/vim-illuminate'
" file search plugin
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
Plug 'junegunn/fzf.vim'
" highlights trailing whitespaces and trims them upon save
Plug 'ntpeters/vim-better-whitespace'
" maps git commands to vim commandline such as :G status
Plug 'tpope/vim-fugitive'
" shows added and modified lines within a file according to git status
Plug 'airblade/vim-gitgutter'
" shows tags on the right for quick jump
Plug 'preservim/tagbar'
" reloads files automatically when they are changed outside vim
Plug 'djoshea/vim-autoread'
" go support
Plug 'fatih/vim-go', { 'tag': '*' }
" c# support
Plug 'OmniSharp/omnisharp-vim'
" Mappings, code-actions available flag and statusline integration
Plug 'nickspoons/vim-sharpenup'
" Linting/error highlighting
Plug 'dense-analysis/ale'
" Autocompletion
Plug 'prabirshrestha/asyncomplete.vim'
" code autocomplete
" Plug 'ycm-core/YouCompleteMe'
" code snippet too
Plug 'SirVer/ultisnips'
Plug 'honza/vim-snippets'
" closes all types of quotes and brackets automatically
Plug 'gosukiwi/vim-smartpairs'
" enables beautiful file icons in nerd tree
Plug 'ryanoasis/vim-devicons'

call plug#end()

set incsearch
set ignorecase smartcase
set ruler
set showcmd
set tabstop=4
set shiftwidth=4
set smartindent
set autoindent
set expandtab
set history=1000
set wildmenu
set splitright
set splitbelow
set foldcolumn=2
set number

augroup numbertoggle
  autocmd!
  autocmd BufEnter,FocusGained,InsertLeave,WinEnter * if &filetype != 'nerdtree' && &filetype != 'tagbar' && mode() != "i" | set rnu | set nonu | endif
  autocmd BufLeave,FocusLost,InsertEnter,WinLeave   * if &filetype != 'nerdtree' && &filetype != 'tagbar' | set nornu | set nu | endif
augroup END

augroup vimrcEx
  au!
  autocmd FileType text setlocal textwidth=80
augroup END

" gruvbox
" -------
colorscheme gruvbox
set bg=dark

" nerd tree
" ---------
" Start NERDTree. If a file is specified, move the cursor to its window.
autocmd StdinReadPre * let s:std_in=1
autocmd VimEnter * NERDTree | if argc() > 0 || exists("s:std_in") | wincmd p | endif

" Exit Vim if NERDTree is the only window remaining in the only tab.
autocmd BufEnter * if tabpagenr('$') == 1 && winnr('$') == 1 && exists('b:NERDTree') && b:NERDTree.isTabTree() | quit | endif

" Close the tab if NERDTree is the only window remaining in it.
autocmd BufEnter * if winnr('$') == 1 && exists('b:NERDTree') && b:NERDTree.isTabTree() | quit | endif

" If another buffer tries to replace NERDTree, put it in the other window, and bring back NERDTree.
autocmd BufEnter * if bufname('#') =~ 'NERD_tree_\d\+' && bufname('%') !~ 'NERD_tree_\d\+' && winnr('$') > 1 |
    \ let buf=bufnr() | buffer# | execute "normal! \<C-W>w" | execute 'buffer'.buf | endif

" Open the existing NERDTree on each new tab.
autocmd BufWinEnter * if getcmdwintype() == '' && getbufvar('%', '&buftype', 'ERROR') != 'quickfix' | silent NERDTreeMirror | endif

let g:NERDTreeGitStatusUseNerdFonts = 2 " you should install nerdfonts by yourself. default: 0
let g:NERDTreeWinSize = 40
let g:NERDTreeMinimalUI = 1
let g:NERDTreeIgnore = ['^node_modules$', '^bin$', '^obj$']

" air-line
" --------
let g:airline_theme='distinguished'
let g:airline#extensions#tabline#enabled = 0
let g:airline_powerline_fonts = 1

" webdevicons
" -----------
" loading the plugin
let g:webdevicons_enable = 1
" adding the flags to NERDTree
let g:webdevicons_enable_nerdtree = 1
" whether or not to show the nerdtree brackets around flags
let g:webdevicons_conceal_nerdtree_brackets = 1
" arrange padding before and after icons in nerd tree
let g:WebDevIconsNerdTreeAfterGlyphPadding = ' '
let g:WebDevIconsNerdTreeBeforeGlyphPadding = ' '
set encoding=UTF-8
" after a re-source, fix syntax matching issues (concealing brackets):
if exists('g:loaded_webdevicons')
  call webdevicons#refresh()
endif

" better whitespace
" -----------------
let g:better_whitespace_enabled=1
let g:strip_whitespace_on_save=1
let g:strip_whitespace_confirm=0

" vim go
" ------
let g:go_highlight_function_calls = 1
let g:go_fmt_autosave = 1
syntax on

" ulti snips
" ----------
" Alt-j to expand (like CMD-Down to enter)
let g:UltiSnipsExpandTrigger="∆"
" Alt-l to jump forward
let g:UltiSnipsJumpForwardTrigger="¬"
" Alt-h to jump backward
let g:UltiSnipsJumpBackwardTrigger="˙"

" sharpenup
" ---------
let g:sharpenup_map_prefix='≥'
let g:sharpenup_codeactions_autocmd='CursorHold,CursorMoved'

" ALE
" ---
let g:ale_sign_error = '•'
let g:ale_sign_warning = '•'
let g:ale_sign_info = '·'
let g:ale_sign_style_error = '·'
let g:ale_sign_style_warning = '·'

let g:ale_linters = { 'cs': ['OmniSharp'] }
let g:ale_fixers = {
\   '*': ['remove_trailing_lines', 'trim_whitespace'],
\   'javascript': ['eslint'],
\}
let g:ale_fix_on_save = 1

" Asyncomplete
" ------------
let g:asyncomplete_auto_popup = 1
let g:asyncomplete_auto_completeopt = 0
imap <c-space> <Plug>(asyncomplete_force_refresh)
set completeopt=menuone,noinsert,noselect,preview
set completepopup=highlight:Pmenu,border:off
autocmd! CompleteDone * if pumvisible() == 0 | pclose | endif

" OmniSharp
" ---------
let g:OmniSharp_popup_position = 'peek'
let g:OmniSharp_popup_options = {
\ 'highlight': 'Normal',
\ 'padding': [0, 0, 0, 0],
\ 'border': [1]
\}
let g:OmniSharp_popup_mappings = {
\ 'sigNext': '<C-n>',
\ 'sigPrev': '<C-p>',
\ 'pageDown': ['<C-f>', '<PageDown>'],
\ 'pageUp': ['<C-b>', '<PageUp>']
\}
let g:OmniSharp_want_snippet = 1
let g:OmniSharp_highlight_groups = {
\ 'ExcludedCode': 'NonText'
\}

" key mappings
" ------------

" Alt-t to open fuzzy search
nnoremap † :FZF<CR>
" Alt-o to open find symbol in workspace
nmap ø <Plug>(YCMFindSymbolInWorkspace)
" F8 to open/close tagbar
nmap <F8> :TagbarToggle<CR>

" Ctrl-, to open ~/.vimrc
nnoremap <silent> ≤ :tabedit ~/.vimrc<CR>
" Alt-w to close
nnoremap ∑ :close<CR>
" Alt-Shift-w to close all
nnoremap „ :%bd<CR>:NERDTreeToggle <CR>
" Alt-q to quit
nnoremap œ :qa<CR>
" Alt-s to save (write)
nnoremap ß :w<CR>
" Alt-l to move cursor to right window
nnoremap ¬ <C-W>l
" Alt-h to move cursor to left window
nnoremap ˙ <C-W>h
" Alt-j to move cursor to below window
nnoremap ∆ <C-W>j
" Alt-k to move cursor to above window
nnoremap ˚ <C-W>k
" Alt-Shift-l to move to next buffer
nnoremap Ò :bn<CR>
" Alt-Shift-h to move to previous buffer
nnoremap Ó :bp<CR>
" Alt-p to show yank-ring window
nnoremap π :YRShow<CR>
" Alt-Shift-p to paste from clipboard
noremap ∏ "+P
" Alt-Shift-y to yank to clipboard
noremap Á "+y
" Alt-a to select all text
nnoremap å ggVG
" Alt-Shift-. to increase window width
nnoremap ˘ <C-w>>
" Alt-Shift-, to decrease window width
nnoremap ¯ <C-w><

" Fugitive
" --------
" Alt-g Alt-s to git status
nnoremap ©ß :G status<CR>
" Alt-g Alt-a to git add -A
nnoremap ©å :G add -A<CR>
" Alt-g Alt-c to git commit -m ''
nnoremap ©ç :G commit -m ''<left>
" Alt-g Alt-p to git push
nnoremap ©π :G push<CR>

" NERDTree
" --------
" Alt-f to sync file in nerd tree
nnoremap ƒ :NERDTreeFind<CR><C-W>l

" Go
" --
" Alt-r to run
autocmd FileType go nnoremap ® :w<CR>:GoBuild<CR>:GoRun<CR>
" Alt-b to build
autocmd FileType go nnoremap ∫ :w<CR>:GoBuild<CR>
" Alt-c to comment
autocmd FileType go nnoremap ç mc^i// <Esc>`clll
" Alt-Shift-c to uncomment
autocmd FileType go nnoremap Ç mc^xxx`chhh

" C#
" --
" Alt-Shift-o to fix usings and code format
nnoremap Ø :OmniSharpCodeFormat<CR>:OmniSharpFixUsings<CR>
" Alt-. Alt-. to open code actions
nnoremap ≥≥ :OmniSharpGetCodeActions<CR>
